var iframe=document.getElementById("setiframe"),ajaxurl=cp_setting.admin_url,setUrl=cp_setting.set_url;iframe.src=setUrl;iframe.onload=function(){iframe.contentWindow.postMessage({type:"themedata",set:cp_setting.set_json,cats:cp_setting.cats,roles:cp_setting.roles,linkcats:cp_setting.linkcats,admin_url:cp_setting.admin_url,wp_option:cp_setting.wp_option},setUrl);updateIframeHeight()};jQuery(window).resize(function(){updateIframeHeight()});window.addEventListener("message",function(a){if("saveThemeData"==a.data.type)jQuery.post(ajaxurl,{action:"corepress_pro_save_data",set:a.data.set},function(a){200==JSON.parse(a).code?(vue.$message({message:"\u4fdd\u5b58\u6210\u529f\uff01",type:"success",offset:50}),postToSet("save_status",{status:1})):(vue.$message({message:"\u4fdd\u5b58\u5931\u8d25\uff01",type:"erro",offset:50}),postToSet("save_status",{status:0}))});else if("selectImg"==a.data.type){var b;b=wp.media({title:"\u9009\u62e9\u56fe\u7247",button:{text:"\u63d2\u5165"},multiple:!1});b.on("select",function(){attachment=b.state().get("selection").first().toJSON();postToSet("setimg",{url:attachment.url,mark:a.data.mark,index:a.data.index})});b.open()}else"mailtest"==a.data.type&&jQuery.post(ajaxurl,{action:"corepress_mailtest",user:a.data.mailData.user,pwd:a.data.mailData.pwd,name:a.data.mailData.name,port:a.data.mailData.port,host:a.data.mailData.host,type:a.data.mailData.type,testmail:a.data.mailData.testmail},function(a){a=JSON.parse(a);postToSet("testmailback","back");a?200==a.code?vue.$message({message:a.msg,type:"success",offset:50}):vue.$message({message:a.msg,type:"warning",offset:50}):vue.$message({message:"\u672a\u77e5\u9519\u8bef",type:"error",offset:50})})},!1);var vue=new Vue({el:"#app"});function postToSet(a,b){iframe.contentWindow.postMessage({type:a,data:b},setUrl)}function updateIframeHeight(){var a=0;void 0!=jQuery(".update-nag").height()&&(a=jQuery(".update-nag").height());iframe.height=jQuery("#wpwrap").height()-jQuery("#wpfooter").height()-a-jQuery("#wpadminbar").height()-65};